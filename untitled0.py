# -*- coding: utf-8 -*-
"""
Financial Dashboard - Multi-asset Comparison
Enhanced version with metrics, drawdowns, news, multilingual support, and Credit Risk Analysis
"""

import streamlit as st
import pandas as pd
import numpy as np
import yfinance as yf
from datetime import datetime, timedelta
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import feedparser
import requests
from scipy.stats import norm

# =============================================================================
# TRANSLATIONS
# =============================================================================
TRANSLATIONS = {
    "English": {
        # General
        "page_title": "Financial Dashboard",
        "main_title": "ðŸ“ˆ Financial Dashboard",
        "comparison": "Comparison",
        "vs": "vs",
        "years": "years",
        "over": "over",
        
        # Sidebar
        "settings": "âš™ï¸ Settings",
        "language": "ðŸŒ Language",
        "asset_selection": "Asset Selection",
        "first_asset": "First asset",
        "second_asset": "Second asset",
        "period": "Period",
        "num_years": "Number of years",
        "display_options": "Display Options",
        "show_normalized": "Show normalized prices",
        "show_drawdown": "Show drawdowns",
        "show_volume": "Show volumes",
        "refresh_data": "ðŸ”„ Refresh data",
        "last_update": "Last update",
        "created_with": "Dashboard created with Streamlit",
        
        # Asset categories
        "cryptocurrencies": "Cryptocurrencies",
        "indices": "Indices",
        "tech_stocks": "Tech Stocks",
        "commodities": "Commodities",
        
        # Metrics
        "key_metrics": "ðŸ“Š Key Metrics",
        "return": "Return",
        "volatility": "Volatility",
        "current_price": "Current Price",
        "sharpe": "Sharpe",
        
        # Charts
        "performance_comparison": "ðŸ“ˆ Performance Comparison",
        "normalized_prices": "Normalized prices",
        "prices": "Prices",
        "normalized_price_zscore": "Normalized Price (z-score)",
        "price_usd": "Price ($)",
        "date": "Date",
        "asset": "Asset",
        
        # Drawdowns
        "drawdowns_title": "ðŸ“‰ Drawdowns (losses from peak)",
        "drawdowns_from_ath": "Drawdowns from all-time highs",
        "max_drawdown": "Max Drawdown",
        
        # Volume
        "trading_volumes": "ðŸ“Š Trading Volumes",
        "volume": "Volume",
        
        # Correlation
        "correlation_analysis": "ðŸ”— Correlation Analysis",
        "overall_correlation": "Overall Correlation",
        "rolling_correlation": "Rolling Correlation",
        "days": "days",
        "interpretation": "Interpretation",
        "strong_positive": "Strong positive correlation",
        "moderate": "Moderate correlation",
        "weak": "Weak correlation",
        "negative": "Negative correlation",
        
        # News
        "recent_news": "ðŸ“° Recent News",
        "no_news": "No news available",
        
        # Data
        "raw_data": "ðŸ“‹ Raw Data",
        "view_data": "View data",
        "merged_data": "View merged data",
        
        # Export
        "export_data": "ðŸ’¾ Export Data",
        "download": "ðŸ“¥ Download",
        
        # Errors
        "loading_data": "Loading data...",
        "error_loading": "Unable to load data. Please try again later.",
        "error_fetching": "Error fetching",
        
        # Economic Analysis
        "economic_analysis": "ðŸŒ Economic Analysis by Continent",
        "select_continent": "Select a continent",
        "generate_analysis": "Generate Analysis",
        "analysis_disclaimer": "This analysis is generated by AI and should not be considered as financial advice.",
        "loading_analysis": "Generating economic analysis...",
        "api_key_required": "API Key Required",
        "api_key_help": "Get your free API key at",
        "enter_api_key": "Enter your Groq API key",
        "analysis_error": "Error generating analysis. Please check your API key and try again.",
        "continents": {
            "north_america": "North America",
            "south_america": "South America", 
            "europe": "Europe",
            "asia": "Asia",
            "africa": "Africa",
            "oceania": "Oceania"
        },
        "economic_indicators": "Key Economic Indicators",
        "ai_analysis": "AI Economic Analysis",
        "last_analysis": "Analysis generated on",
        
        # Credit Risk Analysis
        "credit_risk": "ðŸ¦ Credit Risk Analysis",
        "credit_risk_title": "Credit Risk Analysis",
        "enter_ticker": "Enter ticker symbol",
        "analyze_button": "Analyze Credit Risk",
        "merton_model": "Merton Structural Model",
        "ml_model": "ML Model (Historical)",
        "distance_to_default": "Distance to Default",
        "probability_of_default": "Probability of Default",
        "risk_category": "Risk Category",
        "very_low_risk": "Very Low Risk",
        "low_risk": "Low Risk",
        "moderate_risk": "Moderate Risk",
        "high_risk": "High Risk",
        "very_high_risk": "Very High Risk",
        "model_inputs": "Model Inputs",
        "market_cap": "Market Cap",
        "total_debt": "Total Debt",
        "asset_value": "Asset Value (V)",
        "equity_volatility": "Equity Volatility",
        "risk_free_rate": "Risk-Free Rate",
        "time_horizon": "Time Horizon",
        "merton_explanation": "The Merton model treats equity as a call option on firm assets. Default occurs if asset value falls below debt at maturity.",
        "ml_explanation": "ML model trained on historical bankruptcy data (1999-2018). Note: Live predictions require feature mapping from financial statements.",
        "data_unavailable": "Required financial data not available for this ticker.",
        "analyzing": "Analyzing credit risk...",
        "credit_risk_comparison": "Credit Risk Comparison",
        "benchmark_companies": "Benchmark Companies",
    },
    
    "FranÃ§ais": {
        # General
        "page_title": "Dashboard Financier",
        "main_title": "ðŸ“ˆ Dashboard Financier",
        "comparison": "Comparaison",
        "vs": "vs",
        "years": "ans",
        "over": "sur",
        
        # Sidebar
        "settings": "âš™ï¸ ParamÃ¨tres",
        "language": "ðŸŒ Langue",
        "asset_selection": "SÃ©lection des actifs",
        "first_asset": "Premier actif",
        "second_asset": "DeuxiÃ¨me actif",
        "period": "PÃ©riode",
        "num_years": "Nombre d'annÃ©es",
        "display_options": "Options d'affichage",
        "show_normalized": "Afficher les prix normalisÃ©s",
        "show_drawdown": "Afficher les drawdowns",
        "show_volume": "Afficher les volumes",
        "refresh_data": "ðŸ”„ RafraÃ®chir les donnÃ©es",
        "last_update": "DerniÃ¨re mise Ã  jour",
        "created_with": "Dashboard crÃ©Ã© avec Streamlit",
        
        # Asset categories
        "cryptocurrencies": "Cryptomonnaies",
        "indices": "Indices",
        "tech_stocks": "Actions Tech",
        "commodities": "MatiÃ¨res premiÃ¨res",
        
        # Metrics
        "key_metrics": "ðŸ“Š MÃ©triques clÃ©s",
        "return": "Rendement",
        "volatility": "VolatilitÃ©",
        "current_price": "Prix actuel",
        "sharpe": "Sharpe",
        
        # Charts
        "performance_comparison": "ðŸ“ˆ Comparaison des performances",
        "normalized_prices": "Prix normalisÃ©s",
        "prices": "Prix",
        "normalized_price_zscore": "Prix normalisÃ© (z-score)",
        "price_usd": "Prix ($)",
        "date": "Date",
        "asset": "Actif",
        
        # Drawdowns
        "drawdowns_title": "ðŸ“‰ Drawdowns (pertes depuis le plus haut)",
        "drawdowns_from_ath": "Drawdowns depuis les plus hauts historiques",
        "max_drawdown": "Drawdown max",
        
        # Volume
        "trading_volumes": "ðŸ“Š Volumes d'Ã©change",
        "volume": "Volume",
        
        # Correlation
        "correlation_analysis": "ðŸ”— Analyse de corrÃ©lation",
        "overall_correlation": "CorrÃ©lation globale",
        "rolling_correlation": "CorrÃ©lation glissante",
        "days": "jours",
        "interpretation": "InterprÃ©tation",
        "strong_positive": "Forte corrÃ©lation positive",
        "moderate": "CorrÃ©lation modÃ©rÃ©e",
        "weak": "Faible corrÃ©lation",
        "negative": "CorrÃ©lation nÃ©gative",
        
        # News
        "recent_news": "ðŸ“° ActualitÃ©s rÃ©centes",
        "no_news": "Aucune actualitÃ© disponible",
        
        # Data
        "raw_data": "ðŸ“‹ DonnÃ©es brutes",
        "view_data": "Voir les donnÃ©es",
        "merged_data": "Voir les donnÃ©es fusionnÃ©es",
        
        # Export
        "export_data": "ðŸ’¾ Exporter les donnÃ©es",
        "download": "ðŸ“¥ TÃ©lÃ©charger",
        
        # Errors
        "loading_data": "Chargement des donnÃ©es...",
        "error_loading": "Impossible de charger les donnÃ©es. Veuillez rÃ©essayer plus tard.",
        "error_fetching": "Erreur lors du chargement de",
        
        # Economic Analysis
        "economic_analysis": "ðŸŒ Analyse Ã‰conomique par Continent",
        "select_continent": "SÃ©lectionner un continent",
        "generate_analysis": "GÃ©nÃ©rer l'analyse",
        "analysis_disclaimer": "Cette analyse est gÃ©nÃ©rÃ©e par IA et ne constitue pas un conseil financier.",
        "loading_analysis": "GÃ©nÃ©ration de l'analyse Ã©conomique...",
        "api_key_required": "ClÃ© API requise",
        "api_key_help": "Obtenez votre clÃ© API gratuite sur",
        "enter_api_key": "Entrez votre clÃ© API Groq",
        "analysis_error": "Erreur lors de la gÃ©nÃ©ration. VÃ©rifiez votre clÃ© API et rÃ©essayez.",
        "continents": {
            "north_america": "AmÃ©rique du Nord",
            "south_america": "AmÃ©rique du Sud",
            "europe": "Europe",
            "asia": "Asie",
            "africa": "Afrique",
            "oceania": "OcÃ©anie"
        },
        "economic_indicators": "Indicateurs Ã‰conomiques ClÃ©s",
        "ai_analysis": "Analyse Ã‰conomique IA",
        "last_analysis": "Analyse gÃ©nÃ©rÃ©e le",
        
        # Credit Risk Analysis
        "credit_risk": "ðŸ¦ Analyse du Risque de CrÃ©dit",
        "credit_risk_title": "Analyse du Risque de CrÃ©dit",
        "enter_ticker": "Entrez le symbole boursier",
        "analyze_button": "Analyser le Risque de CrÃ©dit",
        "merton_model": "ModÃ¨le Structurel de Merton",
        "ml_model": "ModÃ¨le ML (Historique)",
        "distance_to_default": "Distance au DÃ©faut",
        "probability_of_default": "ProbabilitÃ© de DÃ©faut",
        "risk_category": "CatÃ©gorie de Risque",
        "very_low_risk": "Risque TrÃ¨s Faible",
        "low_risk": "Risque Faible",
        "moderate_risk": "Risque ModÃ©rÃ©",
        "high_risk": "Risque Ã‰levÃ©",
        "very_high_risk": "Risque TrÃ¨s Ã‰levÃ©",
        "model_inputs": "EntrÃ©es du ModÃ¨le",
        "market_cap": "Capitalisation BoursiÃ¨re",
        "total_debt": "Dette Totale",
        "asset_value": "Valeur des Actifs (V)",
        "equity_volatility": "VolatilitÃ© des Actions",
        "risk_free_rate": "Taux Sans Risque",
        "time_horizon": "Horizon Temporel",
        "merton_explanation": "Le modÃ¨le de Merton traite les capitaux propres comme une option d'achat sur les actifs de l'entreprise.",
        "ml_explanation": "ModÃ¨le ML entraÃ®nÃ© sur des donnÃ©es historiques de faillite (1999-2018).",
        "data_unavailable": "DonnÃ©es financiÃ¨res requises non disponibles pour ce ticker.",
        "analyzing": "Analyse du risque de crÃ©dit en cours...",
        "credit_risk_comparison": "Comparaison du Risque de CrÃ©dit",
        "benchmark_companies": "Entreprises de RÃ©fÃ©rence",
    },
    
    "EspaÃ±ol": {
        "page_title": "Panel Financiero",
        "main_title": "ðŸ“ˆ Panel Financiero",
        "comparison": "ComparaciÃ³n",
        "vs": "vs",
        "years": "aÃ±os",
        "over": "durante",
        "settings": "âš™ï¸ ConfiguraciÃ³n",
        "language": "ðŸŒ Idioma",
        "asset_selection": "SelecciÃ³n de activos",
        "first_asset": "Primer activo",
        "second_asset": "Segundo activo",
        "period": "PerÃ­odo",
        "num_years": "NÃºmero de aÃ±os",
        "display_options": "Opciones de visualizaciÃ³n",
        "show_normalized": "Mostrar precios normalizados",
        "show_drawdown": "Mostrar drawdowns",
        "show_volume": "Mostrar volÃºmenes",
        "refresh_data": "ðŸ”„ Actualizar datos",
        "last_update": "Ãšltima actualizaciÃ³n",
        "created_with": "Panel creado con Streamlit",
        "cryptocurrencies": "Criptomonedas",
        "indices": "Ãndices",
        "tech_stocks": "Acciones tecnolÃ³gicas",
        "commodities": "Materias primas",
        "key_metrics": "ðŸ“Š MÃ©tricas clave",
        "return": "Rendimiento",
        "volatility": "Volatilidad",
        "current_price": "Precio actual",
        "sharpe": "Sharpe",
        "performance_comparison": "ðŸ“ˆ ComparaciÃ³n de rendimiento",
        "normalized_prices": "Precios normalizados",
        "prices": "Precios",
        "normalized_price_zscore": "Precio normalizado (z-score)",
        "price_usd": "Precio ($)",
        "date": "Fecha",
        "asset": "Activo",
        "drawdowns_title": "ðŸ“‰ Drawdowns (pÃ©rdidas desde mÃ¡ximos)",
        "drawdowns_from_ath": "Drawdowns desde mÃ¡ximos histÃ³ricos",
        "max_drawdown": "Drawdown mÃ¡ximo",
        "trading_volumes": "ðŸ“Š VolÃºmenes de negociaciÃ³n",
        "volume": "Volumen",
        "correlation_analysis": "ðŸ”— AnÃ¡lisis de correlaciÃ³n",
        "overall_correlation": "CorrelaciÃ³n global",
        "rolling_correlation": "CorrelaciÃ³n mÃ³vil",
        "days": "dÃ­as",
        "interpretation": "InterpretaciÃ³n",
        "strong_positive": "Fuerte correlaciÃ³n positiva",
        "moderate": "CorrelaciÃ³n moderada",
        "weak": "CorrelaciÃ³n dÃ©bil",
        "negative": "CorrelaciÃ³n negativa",
        "recent_news": "ðŸ“° Noticias recientes",
        "no_news": "No hay noticias disponibles",
        "raw_data": "ðŸ“‹ Datos brutos",
        "view_data": "Ver datos",
        "merged_data": "Ver datos combinados",
        "export_data": "ðŸ’¾ Exportar datos",
        "download": "ðŸ“¥ Descargar",
        "loading_data": "Cargando datos...",
        "error_loading": "No se pueden cargar los datos. IntÃ©ntelo de nuevo mÃ¡s tarde.",
        "error_fetching": "Error al cargar",
        "economic_analysis": "ðŸŒ AnÃ¡lisis EconÃ³mico por Continente",
        "select_continent": "Seleccionar un continente",
        "generate_analysis": "Generar AnÃ¡lisis",
        "analysis_disclaimer": "Este anÃ¡lisis es generado por IA y no debe considerarse como consejo financiero.",
        "loading_analysis": "Generando anÃ¡lisis econÃ³mico...",
        "api_key_required": "Clave API requerida",
        "api_key_help": "ObtÃ©n tu clave API gratuita en",
        "enter_api_key": "Ingresa tu clave API de Groq",
        "analysis_error": "Error al generar el anÃ¡lisis. Verifica tu clave API e intenta de nuevo.",
        "continents": {
            "north_america": "AmÃ©rica del Norte",
            "south_america": "AmÃ©rica del Sur",
            "europe": "Europa",
            "asia": "Asia",
            "africa": "Ãfrica",
            "oceania": "OceanÃ­a"
        },
        "economic_indicators": "Indicadores EconÃ³micos Clave",
        "ai_analysis": "AnÃ¡lisis EconÃ³mico IA",
        "last_analysis": "AnÃ¡lisis generado el",
        "credit_risk": "ðŸ¦ AnÃ¡lisis de Riesgo de CrÃ©dito",
        "credit_risk_title": "AnÃ¡lisis de Riesgo de CrÃ©dito",
        "enter_ticker": "Ingrese el sÃ­mbolo bursÃ¡til",
        "analyze_button": "Analizar Riesgo de CrÃ©dito",
        "merton_model": "Modelo Estructural de Merton",
        "ml_model": "Modelo ML (HistÃ³rico)",
        "distance_to_default": "Distancia al Incumplimiento",
        "probability_of_default": "Probabilidad de Incumplimiento",
        "risk_category": "CategorÃ­a de Riesgo",
        "very_low_risk": "Riesgo Muy Bajo",
        "low_risk": "Riesgo Bajo",
        "moderate_risk": "Riesgo Moderado",
        "high_risk": "Riesgo Alto",
        "very_high_risk": "Riesgo Muy Alto",
        "model_inputs": "Entradas del Modelo",
        "market_cap": "CapitalizaciÃ³n de Mercado",
        "total_debt": "Deuda Total",
        "asset_value": "Valor de Activos (V)",
        "equity_volatility": "Volatilidad de Acciones",
        "risk_free_rate": "Tasa Libre de Riesgo",
        "time_horizon": "Horizonte Temporal",
        "merton_explanation": "El modelo de Merton trata el capital como una opciÃ³n de compra sobre los activos de la empresa.",
        "ml_explanation": "Modelo ML entrenado con datos histÃ³ricos de quiebra (1999-2018).",
        "data_unavailable": "Datos financieros requeridos no disponibles para este ticker.",
        "analyzing": "Analizando riesgo de crÃ©dito...",
        "credit_risk_comparison": "ComparaciÃ³n de Riesgo de CrÃ©dito",
        "benchmark_companies": "Empresas de Referencia",
    },
    
    "ä¸­æ–‡": {
        "page_title": "é‡‘èžä»ªè¡¨æ¿",
        "main_title": "ðŸ“ˆ é‡‘èžä»ªè¡¨æ¿",
        "comparison": "æ¯”è¾ƒ",
        "vs": "ä¸Ž",
        "years": "å¹´",
        "over": "æœŸé—´",
        "settings": "âš™ï¸ è®¾ç½®",
        "language": "ðŸŒ è¯­è¨€",
        "asset_selection": "èµ„äº§é€‰æ‹©",
        "first_asset": "ç¬¬ä¸€èµ„äº§",
        "second_asset": "ç¬¬äºŒèµ„äº§",
        "period": "æ—¶é—´æ®µ",
        "num_years": "å¹´æ•°",
        "display_options": "æ˜¾ç¤ºé€‰é¡¹",
        "show_normalized": "æ˜¾ç¤ºæ ‡å‡†åŒ–ä»·æ ¼",
        "show_drawdown": "æ˜¾ç¤ºå›žæ’¤",
        "show_volume": "æ˜¾ç¤ºæˆäº¤é‡",
        "refresh_data": "ðŸ”„ åˆ·æ–°æ•°æ®",
        "last_update": "æœ€åŽæ›´æ–°",
        "created_with": "ä½¿ç”¨Streamlitåˆ›å»ºçš„ä»ªè¡¨æ¿",
        "cryptocurrencies": "åŠ å¯†è´§å¸",
        "indices": "æŒ‡æ•°",
        "tech_stocks": "ç§‘æŠ€è‚¡",
        "commodities": "å¤§å®—å•†å“",
        "key_metrics": "ðŸ“Š å…³é”®æŒ‡æ ‡",
        "return": "å›žæŠ¥çŽ‡",
        "volatility": "æ³¢åŠ¨çŽ‡",
        "current_price": "å½“å‰ä»·æ ¼",
        "sharpe": "å¤æ™®æ¯”çŽ‡",
        "performance_comparison": "ðŸ“ˆ ç»©æ•ˆæ¯”è¾ƒ",
        "normalized_prices": "æ ‡å‡†åŒ–ä»·æ ¼",
        "prices": "ä»·æ ¼",
        "normalized_price_zscore": "æ ‡å‡†åŒ–ä»·æ ¼ (z-score)",
        "price_usd": "ä»·æ ¼ ($)",
        "date": "æ—¥æœŸ",
        "asset": "èµ„äº§",
        "drawdowns_title": "ðŸ“‰ å›žæ’¤ï¼ˆä»Žå³°å€¼çš„æŸå¤±ï¼‰",
        "drawdowns_from_ath": "ä»ŽåŽ†å²é«˜ç‚¹çš„å›žæ’¤",
        "max_drawdown": "æœ€å¤§å›žæ’¤",
        "trading_volumes": "ðŸ“Š äº¤æ˜“é‡",
        "volume": "æˆäº¤é‡",
        "correlation_analysis": "ðŸ”— ç›¸å…³æ€§åˆ†æž",
        "overall_correlation": "æ€»ä½“ç›¸å…³æ€§",
        "rolling_correlation": "æ»šåŠ¨ç›¸å…³æ€§",
        "days": "å¤©",
        "interpretation": "è§£é‡Š",
        "strong_positive": "å¼ºæ­£ç›¸å…³",
        "moderate": "ä¸­ç­‰ç›¸å…³",
        "weak": "å¼±ç›¸å…³",
        "negative": "è´Ÿç›¸å…³",
        "recent_news": "ðŸ“° æœ€æ–°æ¶ˆæ¯",
        "no_news": "æš‚æ— æ–°é—»",
        "raw_data": "ðŸ“‹ åŽŸå§‹æ•°æ®",
        "view_data": "æŸ¥çœ‹æ•°æ®",
        "merged_data": "æŸ¥çœ‹åˆå¹¶æ•°æ®",
        "export_data": "ðŸ’¾ å¯¼å‡ºæ•°æ®",
        "download": "ðŸ“¥ ä¸‹è½½",
        "loading_data": "åŠ è½½æ•°æ®ä¸­...",
        "error_loading": "æ— æ³•åŠ è½½æ•°æ®ï¼Œè¯·ç¨åŽå†è¯•ã€‚",
        "error_fetching": "èŽ·å–æ•°æ®æ—¶å‡ºé”™",
        "economic_analysis": "ðŸŒ å„å¤§æ´²ç»æµŽåˆ†æž",
        "select_continent": "é€‰æ‹©ä¸€ä¸ªå¤§æ´²",
        "generate_analysis": "ç”Ÿæˆåˆ†æž",
        "analysis_disclaimer": "æ­¤åˆ†æžç”±AIç”Ÿæˆï¼Œä¸åº”è¢«è§†ä¸ºè´¢åŠ¡å»ºè®®ã€‚",
        "loading_analysis": "æ­£åœ¨ç”Ÿæˆç»æµŽåˆ†æž...",
        "api_key_required": "éœ€è¦APIå¯†é’¥",
        "api_key_help": "åœ¨æ­¤èŽ·å–å…è´¹APIå¯†é’¥",
        "enter_api_key": "è¾“å…¥æ‚¨çš„Groq APIå¯†é’¥",
        "analysis_error": "ç”Ÿæˆåˆ†æžæ—¶å‡ºé”™ã€‚è¯·æ£€æŸ¥æ‚¨çš„APIå¯†é’¥å¹¶é‡è¯•ã€‚",
        "continents": {
            "north_america": "åŒ—ç¾Žæ´²",
            "south_america": "å—ç¾Žæ´²",
            "europe": "æ¬§æ´²",
            "asia": "äºšæ´²",
            "africa": "éžæ´²",
            "oceania": "å¤§æ´‹æ´²"
        },
        "economic_indicators": "å…³é”®ç»æµŽæŒ‡æ ‡",
        "ai_analysis": "AIç»æµŽåˆ†æž",
        "last_analysis": "åˆ†æžç”ŸæˆäºŽ",
        "credit_risk": "ðŸ¦ ä¿¡ç”¨é£Žé™©åˆ†æž",
        "credit_risk_title": "ä¿¡ç”¨é£Žé™©åˆ†æž",
        "enter_ticker": "è¾“å…¥è‚¡ç¥¨ä»£ç ",
        "analyze_button": "åˆ†æžä¿¡ç”¨é£Žé™©",
        "merton_model": "Mertonç»“æž„æ¨¡åž‹",
        "ml_model": "æœºå™¨å­¦ä¹ æ¨¡åž‹ï¼ˆåŽ†å²ï¼‰",
        "distance_to_default": "è¿çº¦è·ç¦»",
        "probability_of_default": "è¿çº¦æ¦‚çŽ‡",
        "risk_category": "é£Žé™©ç±»åˆ«",
        "very_low_risk": "æžä½Žé£Žé™©",
        "low_risk": "ä½Žé£Žé™©",
        "moderate_risk": "ä¸­ç­‰é£Žé™©",
        "high_risk": "é«˜é£Žé™©",
        "very_high_risk": "æžé«˜é£Žé™©",
        "model_inputs": "æ¨¡åž‹è¾“å…¥",
        "market_cap": "å¸‚å€¼",
        "total_debt": "æ€»å€ºåŠ¡",
        "asset_value": "èµ„äº§ä»·å€¼ (V)",
        "equity_volatility": "è‚¡æƒæ³¢åŠ¨çŽ‡",
        "risk_free_rate": "æ— é£Žé™©åˆ©çŽ‡",
        "time_horizon": "æ—¶é—´èŒƒå›´",
        "merton_explanation": "Mertonæ¨¡åž‹å°†è‚¡æƒè§†ä¸ºå…¬å¸èµ„äº§çš„çœ‹æ¶¨æœŸæƒã€‚",
        "ml_explanation": "åŸºäºŽåŽ†å²ç ´äº§æ•°æ®ï¼ˆ1999-2018ï¼‰è®­ç»ƒçš„MLæ¨¡åž‹ã€‚",
        "data_unavailable": "æ­¤è‚¡ç¥¨ä»£ç çš„å¿…è¦è´¢åŠ¡æ•°æ®ä¸å¯ç”¨ã€‚",
        "analyzing": "æ­£åœ¨åˆ†æžä¿¡ç”¨é£Žé™©...",
        "credit_risk_comparison": "ä¿¡ç”¨é£Žé™©æ¯”è¾ƒ",
        "benchmark_companies": "åŸºå‡†å…¬å¸",
    },
    
    "Ð ÑƒÑÑÐºÐ¸Ð¹": {
        "page_title": "Ð¤Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ",
        "main_title": "ðŸ“ˆ Ð¤Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ",
        "comparison": "Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ",
        "vs": "Ð¸",
        "years": "Ð»ÐµÑ‚",
        "over": "Ð·Ð°",
        "settings": "âš™ï¸ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸",
        "language": "ðŸŒ Ð¯Ð·Ñ‹Ðº",
        "asset_selection": "Ð’Ñ‹Ð±Ð¾Ñ€ Ð°ÐºÑ‚Ð¸Ð²Ð¾Ð²",
        "first_asset": "ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð°ÐºÑ‚Ð¸Ð²",
        "second_asset": "Ð’Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð°ÐºÑ‚Ð¸Ð²",
        "period": "ÐŸÐµÑ€Ð¸Ð¾Ð´",
        "num_years": "ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð»ÐµÑ‚",
        "display_options": "ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ",
        "show_normalized": "ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð½Ð¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ñ†ÐµÐ½Ñ‹",
        "show_drawdown": "ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾ÑÐ°Ð´ÐºÐ¸",
        "show_volume": "ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¾Ð±ÑŠÑ‘Ð¼Ñ‹",
        "refresh_data": "ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ",
        "last_update": "ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÐµÐµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ",
        "created_with": "ÐŸÐ°Ð½ÐµÐ»ÑŒ ÑÐ¾Ð·Ð´Ð°Ð½Ð° Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Streamlit",
        "cryptocurrencies": "ÐšÑ€Ð¸Ð¿Ñ‚Ð¾Ð²Ð°Ð»ÑŽÑ‚Ñ‹",
        "indices": "Ð˜Ð½Ð´ÐµÐºÑÑ‹",
        "tech_stocks": "Ð¢ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð°ÐºÑ†Ð¸Ð¸",
        "commodities": "Ð¡Ñ‹Ñ€ÑŒÐµÐ²Ñ‹Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹",
        "key_metrics": "ðŸ“Š ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»Ð¸",
        "return": "Ð”Ð¾Ñ…Ð¾Ð´Ð½Ð¾ÑÑ‚ÑŒ",
        "volatility": "Ð’Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ",
        "current_price": "Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ñ†ÐµÐ½Ð°",
        "sharpe": "Ð¨Ð°Ñ€Ð¿",
        "performance_comparison": "ðŸ“ˆ Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸",
        "normalized_prices": "ÐÐ¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ñ†ÐµÐ½Ñ‹",
        "prices": "Ð¦ÐµÐ½Ñ‹",
        "normalized_price_zscore": "ÐÐ¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ñ†ÐµÐ½Ð° (z-score)",
        "price_usd": "Ð¦ÐµÐ½Ð° ($)",
        "date": "Ð”Ð°Ñ‚Ð°",
        "asset": "ÐÐºÑ‚Ð¸Ð²",
        "drawdowns_title": "ðŸ“‰ ÐŸÑ€Ð¾ÑÐ°Ð´ÐºÐ¸ (Ð¿Ð¾Ñ‚ÐµÑ€Ð¸ Ð¾Ñ‚ Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼Ð°)",
        "drawdowns_from_ath": "ÐŸÑ€Ð¾ÑÐ°Ð´ÐºÐ¸ Ð¾Ñ‚ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼Ð¾Ð²",
        "max_drawdown": "ÐœÐ°ÐºÑ. Ð¿Ñ€Ð¾ÑÐ°Ð´ÐºÐ°",
        "trading_volumes": "ðŸ“Š ÐžÐ±ÑŠÑ‘Ð¼Ñ‹ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²",
        "volume": "ÐžÐ±ÑŠÑ‘Ð¼",
        "correlation_analysis": "ðŸ”— ÐÐ½Ð°Ð»Ð¸Ð· ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ð¸",
        "overall_correlation": "ÐžÐ±Ñ‰Ð°Ñ ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ",
        "rolling_correlation": "Ð¡ÐºÐ¾Ð»ÑŒÐ·ÑÑ‰Ð°Ñ ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ",
        "days": "Ð´Ð½ÐµÐ¹",
        "interpretation": "Ð˜Ð½Ñ‚ÐµÑ€Ð¿Ñ€ÐµÑ‚Ð°Ñ†Ð¸Ñ",
        "strong_positive": "Ð¡Ð¸Ð»ÑŒÐ½Ð°Ñ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ",
        "moderate": "Ð£Ð¼ÐµÑ€ÐµÐ½Ð½Ð°Ñ ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ",
        "weak": "Ð¡Ð»Ð°Ð±Ð°Ñ ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ",
        "negative": "ÐžÑ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ",
        "recent_news": "ðŸ“° ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾ÑÑ‚Ð¸",
        "no_news": "ÐÐ¾Ð²Ð¾ÑÑ‚ÐµÐ¹ Ð½ÐµÑ‚",
        "raw_data": "ðŸ“‹ Ð˜ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ",
        "view_data": "ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ",
        "merged_data": "ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½Ñ‘Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ",
        "export_data": "ðŸ’¾ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…",
        "download": "ðŸ“¥ Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ",
        "loading_data": "Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…...",
        "error_loading": "ÐÐµÐ²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ.",
        "error_fetching": "ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ",
        "economic_analysis": "ðŸŒ Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÐÐ½Ð°Ð»Ð¸Ð· Ð¿Ð¾ ÐšÐ¾Ð½Ñ‚Ð¸Ð½ÐµÐ½Ñ‚Ð°Ð¼",
        "select_continent": "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐºÐ¾Ð½Ñ‚Ð¸Ð½ÐµÐ½Ñ‚",
        "generate_analysis": "Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð°Ð½Ð°Ð»Ð¸Ð·",
        "analysis_disclaimer": "Ð­Ñ‚Ð¾Ñ‚ Ð°Ð½Ð°Ð»Ð¸Ð· ÑÐ¾Ð·Ð´Ð°Ð½ Ð˜Ð˜ Ð¸ Ð½Ðµ ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð¾Ð¹ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸ÐµÐ¹.",
        "loading_analysis": "Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°...",
        "api_key_required": "Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ API ÐºÐ»ÑŽÑ‡",
        "api_key_help": "ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ API ÐºÐ»ÑŽÑ‡ Ð½Ð°",
        "enter_api_key": "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Groq API ÐºÐ»ÑŽÑ‡",
        "analysis_error": "ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ API ÐºÐ»ÑŽÑ‡ Ð¸ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.",
        "continents": {
            "north_america": "Ð¡ÐµÐ²ÐµÑ€Ð½Ð°Ñ ÐÐ¼ÐµÑ€Ð¸ÐºÐ°",
            "south_america": "Ð®Ð¶Ð½Ð°Ñ ÐÐ¼ÐµÑ€Ð¸ÐºÐ°",
            "europe": "Ð•Ð²Ñ€Ð¾Ð¿Ð°",
            "asia": "ÐÐ·Ð¸Ñ",
            "africa": "ÐÑ„Ñ€Ð¸ÐºÐ°",
            "oceania": "ÐžÐºÐµÐ°Ð½Ð¸Ñ"
        },
        "economic_indicators": "ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»Ð¸",
        "ai_analysis": "Ð˜Ð˜ Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÐÐ½Ð°Ð»Ð¸Ð·",
        "last_analysis": "ÐÐ½Ð°Ð»Ð¸Ð· ÑÐ¾Ð·Ð´Ð°Ð½",
        "credit_risk": "ðŸ¦ ÐÐ½Ð°Ð»Ð¸Ð· ÐšÑ€ÐµÐ´Ð¸Ñ‚Ð½Ð¾Ð³Ð¾ Ð Ð¸ÑÐºÐ°",
        "credit_risk_title": "ÐÐ½Ð°Ð»Ð¸Ð· ÐšÑ€ÐµÐ´Ð¸Ñ‚Ð½Ð¾Ð³Ð¾ Ð Ð¸ÑÐºÐ°",
        "enter_ticker": "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‚Ð¸ÐºÐµÑ€",
        "analyze_button": "ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐšÑ€ÐµÐ´Ð¸Ñ‚Ð½Ñ‹Ð¹ Ð Ð¸ÑÐº",
        "merton_model": "Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð½Ð°Ñ ÐœÐ¾Ð´ÐµÐ»ÑŒ ÐœÐµÑ€Ñ‚Ð¾Ð½Ð°",
        "ml_model": "ML ÐœÐ¾Ð´ÐµÐ»ÑŒ (Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ‡ÐµÑÐºÐ°Ñ)",
        "distance_to_default": "Ð Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð´Ð¾ Ð”ÐµÑ„Ð¾Ð»Ñ‚Ð°",
        "probability_of_default": "Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ Ð”ÐµÑ„Ð¾Ð»Ñ‚Ð°",
        "risk_category": "ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ð Ð¸ÑÐºÐ°",
        "very_low_risk": "ÐžÑ‡ÐµÐ½ÑŒ ÐÐ¸Ð·ÐºÐ¸Ð¹ Ð Ð¸ÑÐº",
        "low_risk": "ÐÐ¸Ð·ÐºÐ¸Ð¹ Ð Ð¸ÑÐº",
        "moderate_risk": "Ð£Ð¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹ Ð Ð¸ÑÐº",
        "high_risk": "Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð Ð¸ÑÐº",
        "very_high_risk": "ÐžÑ‡ÐµÐ½ÑŒ Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð Ð¸ÑÐº",
        "model_inputs": "Ð’Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð”Ð°Ð½Ð½Ñ‹Ðµ ÐœÐ¾Ð´ÐµÐ»Ð¸",
        "market_cap": "Ð Ñ‹Ð½Ð¾Ñ‡Ð½Ð°Ñ ÐšÐ°Ð¿Ð¸Ñ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ",
        "total_debt": "ÐžÐ±Ñ‰Ð¸Ð¹ Ð”Ð¾Ð»Ð³",
        "asset_value": "Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ ÐÐºÑ‚Ð¸Ð²Ð¾Ð² (V)",
        "equity_volatility": "Ð’Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ ÐÐºÑ†Ð¸Ð¹",
        "risk_free_rate": "Ð‘ÐµÐ·Ñ€Ð¸ÑÐºÐ¾Ð²Ð°Ñ Ð¡Ñ‚Ð°Ð²ÐºÐ°",
        "time_horizon": "Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ð“Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚",
        "merton_explanation": "ÐœÐ¾Ð´ÐµÐ»ÑŒ ÐœÐµÑ€Ñ‚Ð¾Ð½Ð° Ñ€Ð°ÑÑÐ¼Ð°Ñ‚Ñ€Ð¸Ð²Ð°ÐµÑ‚ ÐºÐ°Ð¿Ð¸Ñ‚Ð°Ð» ÐºÐ°Ðº ÐºÐ¾Ð»Ð»-Ð¾Ð¿Ñ†Ð¸Ð¾Ð½ Ð½Ð° Ð°ÐºÑ‚Ð¸Ð²Ñ‹ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸.",
        "ml_explanation": "ML Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð° Ð½Ð° Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ Ð±Ð°Ð½ÐºÑ€Ð¾Ñ‚ÑÑ‚Ð²Ðµ (1999-2018).",
        "data_unavailable": "ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ñ‚Ð¸ÐºÐµÑ€Ð°.",
        "analyzing": "ÐÐ½Ð°Ð»Ð¸Ð· ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð½Ð¾Ð³Ð¾ Ñ€Ð¸ÑÐºÐ°...",
        "credit_risk_comparison": "Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ ÐšÑ€ÐµÐ´Ð¸Ñ‚Ð½Ð¾Ð³Ð¾ Ð Ð¸ÑÐºÐ°",
        "benchmark_companies": "Ð­Ñ‚Ð°Ð»Ð¾Ð½Ð½Ñ‹Ðµ ÐšÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸",
    },
    
    "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©": {
        "page_title": "Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©",
        "main_title": "ðŸ“ˆ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©",
        "comparison": "Ù…Ù‚Ø§Ø±Ù†Ø©",
        "vs": "Ù…Ù‚Ø§Ø¨Ù„",
        "years": "Ø³Ù†ÙˆØ§Øª",
        "over": "Ø®Ù„Ø§Ù„",
        "settings": "âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
        "language": "ðŸŒ Ø§Ù„Ù„ØºØ©",
        "asset_selection": "Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ØµÙˆÙ„",
        "first_asset": "Ø§Ù„Ø£ØµÙ„ Ø§Ù„Ø£ÙˆÙ„",
        "second_asset": "Ø§Ù„Ø£ØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ",
        "period": "Ø§Ù„ÙØªØ±Ø©",
        "num_years": "Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª",
        "display_options": "Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¶",
        "show_normalized": "Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠØ©",
        "show_drawdown": "Ø¹Ø±Ø¶ Ø§Ù„ØªØ±Ø§Ø¬Ø¹Ø§Øª",
        "show_volume": "Ø¹Ø±Ø¶ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØªØ¯Ø§ÙˆÙ„",
        "refresh_data": "ðŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
        "last_update": "Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«",
        "created_with": "Ù„ÙˆØ­Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Streamlit",
        "cryptocurrencies": "Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´ÙØ±Ø©",
        "indices": "Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª",
        "tech_stocks": "Ø£Ø³Ù‡Ù… Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§",
        "commodities": "Ø§Ù„Ø³Ù„Ø¹",
        "key_metrics": "ðŸ“Š Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
        "return": "Ø§Ù„Ø¹Ø§Ø¦Ø¯",
        "volatility": "Ø§Ù„ØªÙ‚Ù„Ø¨",
        "current_price": "Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ",
        "sharpe": "Ø´Ø§Ø±Ø¨",
        "performance_comparison": "ðŸ“ˆ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡",
        "normalized_prices": "Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠØ©",
        "prices": "Ø§Ù„Ø£Ø³Ø¹Ø§Ø±",
        "normalized_price_zscore": "Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ (z-score)",
        "price_usd": "Ø§Ù„Ø³Ø¹Ø± ($)",
        "date": "Ø§Ù„ØªØ§Ø±ÙŠØ®",
        "asset": "Ø§Ù„Ø£ØµÙ„",
        "drawdowns_title": "ðŸ“‰ Ø§Ù„ØªØ±Ø§Ø¬Ø¹Ø§Øª (Ø§Ù„Ø®Ø³Ø§Ø¦Ø± Ù…Ù† Ø§Ù„Ø°Ø±ÙˆØ©)",
        "drawdowns_from_ath": "Ø§Ù„ØªØ±Ø§Ø¬Ø¹Ø§Øª Ù…Ù† Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©",
        "max_drawdown": "Ø£Ù‚ØµÙ‰ ØªØ±Ø§Ø¬Ø¹",
        "trading_volumes": "ðŸ“Š Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØªØ¯Ø§ÙˆÙ„",
        "volume": "Ø§Ù„Ø­Ø¬Ù…",
        "correlation_analysis": "ðŸ”— ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø·",
        "overall_correlation": "Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„ÙƒÙ„ÙŠ",
        "rolling_correlation": "Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ù…ØªØ­Ø±Ùƒ",
        "days": "ÙŠÙˆÙ…",
        "interpretation": "Ø§Ù„ØªÙØ³ÙŠØ±",
        "strong_positive": "Ø§Ø±ØªØ¨Ø§Ø· Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ù‚ÙˆÙŠ",
        "moderate": "Ø§Ø±ØªØ¨Ø§Ø· Ù…Ø¹ØªØ¯Ù„",
        "weak": "Ø§Ø±ØªØ¨Ø§Ø· Ø¶Ø¹ÙŠÙ",
        "negative": "Ø§Ø±ØªØ¨Ø§Ø· Ø³Ù„Ø¨ÙŠ",
        "recent_news": "ðŸ“° Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±",
        "no_news": "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø¨Ø§Ø± Ù…ØªØ§Ø­Ø©",
        "raw_data": "ðŸ“‹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù…",
        "view_data": "Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
        "merged_data": "Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ù…Ø¬Ø©",
        "export_data": "ðŸ’¾ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
        "download": "ðŸ“¥ ØªØ­Ù…ÙŠÙ„",
        "loading_data": "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...",
        "error_loading": "ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.",
        "error_fetching": "Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨",
        "economic_analysis": "ðŸŒ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø§Ø±Ø©",
        "select_continent": "Ø§Ø®ØªØ± Ù‚Ø§Ø±Ø©",
        "generate_analysis": "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„",
        "analysis_disclaimer": "Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙˆÙ„Ø§ ÙŠÙ†Ø¨ØºÙŠ Ø§Ø¹ØªØ¨Ø§Ø±Ù‡ Ù†ØµÙŠØ­Ø© Ù…Ø§Ù„ÙŠØ©.",
        "loading_analysis": "Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ...",
        "api_key_required": "Ù…ÙØªØ§Ø­ API Ù…Ø·Ù„ÙˆØ¨",
        "api_key_help": "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ API Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ Ù…Ù†",
        "enter_api_key": "Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ Groq API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ",
        "analysis_error": "Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ÙØªØ§Ø­ API ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",
        "continents": {
            "north_america": "Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©",
            "south_america": "Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©",
            "europe": "Ø£ÙˆØ±ÙˆØ¨Ø§",
            "asia": "Ø¢Ø³ÙŠØ§",
            "africa": "Ø£ÙØ±ÙŠÙ‚ÙŠØ§",
            "oceania": "Ø£ÙˆÙ‚ÙŠØ§Ù†ÙˆØ³ÙŠØ§"
        },
        "economic_indicators": "Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
        "ai_analysis": "Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
        "last_analysis": "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙÙŠ",
        "credit_risk": "ðŸ¦ ØªØ­Ù„ÙŠÙ„ Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†",
        "credit_risk_title": "ØªØ­Ù„ÙŠÙ„ Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†",
        "enter_ticker": "Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø³Ù‡Ù…",
        "analyze_button": "ØªØ­Ù„ÙŠÙ„ Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†",
        "merton_model": "Ù†Ù…ÙˆØ°Ø¬ Ù…ÙŠØ±ØªÙˆÙ† Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠ",
        "ml_model": "Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù„ÙŠ (ØªØ§Ø±ÙŠØ®ÙŠ)",
        "distance_to_default": "Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„ØªØ®Ù„Ù Ø¹Ù† Ø§Ù„Ø³Ø¯Ø§Ø¯",
        "probability_of_default": "Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù„ØªØ®Ù„Ù Ø¹Ù† Ø§Ù„Ø³Ø¯Ø§Ø¯",
        "risk_category": "ÙØ¦Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±",
        "very_low_risk": "Ù…Ø®Ø§Ø·Ø± Ù…Ù†Ø®ÙØ¶Ø© Ø¬Ø¯Ø§Ù‹",
        "low_risk": "Ù…Ø®Ø§Ø·Ø± Ù…Ù†Ø®ÙØ¶Ø©",
        "moderate_risk": "Ù…Ø®Ø§Ø·Ø± Ù…Ø¹ØªØ¯Ù„Ø©",
        "high_risk": "Ù…Ø®Ø§Ø·Ø± Ø¹Ø§Ù„ÙŠØ©",
        "very_high_risk": "Ù…Ø®Ø§Ø·Ø± Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹",
        "model_inputs": "Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬",
        "market_cap": "Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©",
        "total_debt": "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†",
        "asset_value": "Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ØµÙˆÙ„ (V)",
        "equity_volatility": "ØªÙ‚Ù„Ø¨ Ø§Ù„Ø£Ø³Ù‡Ù…",
        "risk_free_rate": "Ù…Ø¹Ø¯Ù„ Ø®Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ù…Ø®Ø§Ø·Ø±",
        "time_horizon": "Ø§Ù„Ø£ÙÙ‚ Ø§Ù„Ø²Ù…Ù†ÙŠ",
        "merton_explanation": "ÙŠØ¹Ø§Ù…Ù„ Ù†Ù…ÙˆØ°Ø¬ Ù…ÙŠØ±ØªÙˆÙ† Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ© ÙƒØ®ÙŠØ§Ø± Ø´Ø±Ø§Ø¡ Ø¹Ù„Ù‰ Ø£ØµÙˆÙ„ Ø§Ù„Ø´Ø±ÙƒØ©.",
        "ml_explanation": "Ù†Ù…ÙˆØ°Ø¬ ML Ù…Ø¯Ø±Ø¨ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥ÙÙ„Ø§Ø³ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© (1999-2018).",
        "data_unavailable": "Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø².",
        "analyzing": "Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†...",
        "credit_risk_comparison": "Ù…Ù‚Ø§Ø±Ù†Ø© Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†",
        "benchmark_companies": "Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©",
    },
}

# Language configuration (RTL support)
RTL_LANGUAGES = ["Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"]

def get_text(key: str) -> str:
    """Get translated text for the current language."""
    lang = st.session_state.get("language", "English")
    return TRANSLATIONS.get(lang, TRANSLATIONS["English"]).get(key, key)

def t(key: str) -> str:
    """Shorthand for get_text."""
    return get_text(key)


# =============================================================================
# PAGE CONFIGURATION
# =============================================================================
st.set_page_config(
    page_title="Financial Dashboard",
    page_icon="ðŸ“ˆ",
    layout="wide",
    initial_sidebar_state="expanded"
)

# =============================================================================
# SESSION STATE INITIALIZATION
# =============================================================================
if "language" not in st.session_state:
    st.session_state.language = "English"


# =============================================================================
# CUSTOM CSS
# =============================================================================
def apply_custom_css():
    """Apply custom CSS including RTL support and professional parchment theme."""
    is_rtl = st.session_state.language in RTL_LANGUAGES
    direction = "rtl" if is_rtl else "ltr"
    text_align = "right" if is_rtl else "left"
    
    st.markdown(f"""
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Source+Sans+Pro:wght@400;600;700&display=swap');
        
        .stApp {{
            background: linear-gradient(135deg, #F5E6C8 0%, #EDE0C8 50%, #F0E4CE 100%);
            font-family: 'Source Sans Pro', sans-serif;
        }}
        
        .main .block-container {{
            direction: {direction};
            text-align: {text_align};
            padding-top: 2rem;
            max-width: 1200px;
        }}
        
        h1 {{
            font-family: 'Libre Baskerville', serif !important;
            color: #4A3728 !important;
            font-weight: 700 !important;
            letter-spacing: 0.5px;
            border-bottom: 3px solid #8B7355;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem !important;
        }}
        
        h2 {{
            font-family: 'Libre Baskerville', serif !important;
            color: #5D4E37 !important;
            font-weight: 700 !important;
            font-size: 1.5rem !important;
            margin-top: 1rem !important;
            padding-left: 0.5rem;
            border-left: 4px solid #8B7355;
        }}
        
        h3 {{
            font-family: 'Source Sans Pro', sans-serif !important;
            color: #6B5B4A !important;
            font-weight: 600 !important;
            font-size: 1.1rem !important;
            text-transform: uppercase;
            letter-spacing: 1px;
        }}
        
        p, span, label {{
            color: #4A3F35 !important;
        }}
        
        /* Global fix for all text content */
        div[data-testid="stMarkdownContainer"] p,
        div[data-testid="stMarkdownContainer"] span,
        div[data-testid="stMarkdownContainer"] li,
        div[data-testid="stMarkdownContainer"] strong {{
            color: #3D3428 !important;
        }}
        
        /* Fix any div text that might be invisible */
        .main div {{
            color: #3D3428;
        }}
        
        [data-testid="stSidebar"] {{
            background: linear-gradient(180deg, #E8D9BE 0%, #DFD0B8 100%);
            border-right: 1px solid #C4B59B;
            box-shadow: 2px 0 10px rgba(74, 55, 40, 0.1);
        }}
        
        [data-testid="stMetric"] {{
            background: linear-gradient(145deg, #FFFEFA 0%, #FBF6ED 100%);
            padding: 1.25rem 1.5rem;
            border-radius: 12px;
            border: 1px solid #D4C5A9;
            box-shadow: 0 4px 15px rgba(74, 55, 40, 0.08);
            transition: all 0.3s ease;
        }}
        
        [data-testid="stMetric"]:hover {{
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 55, 40, 0.12);
        }}
        
        /* Fix metric label visibility */
        [data-testid="stMetric"] label {{
            color: #5D4E37 !important;
        }}
        
        /* Fix metric VALUE visibility - this is the main fix */
        [data-testid="stMetric"] [data-testid="stMetricValue"] {{
            color: #2D2418 !important;
        }}
        
        [data-testid="stMetric"] [data-testid="stMetricValue"] div {{
            color: #2D2418 !important;
        }}
        
        /* Fix metric delta visibility */
        [data-testid="stMetric"] [data-testid="stMetricDelta"] {{
            color: #3D3428 !important;
        }}
        
        [data-testid="stMetric"] [data-testid="stMetricDelta"] svg {{
            fill: #3D3428 !important;
        }}
        
        .stButton > button {{
            background: linear-gradient(145deg, #FFFEFA 0%, #F5EFE0 100%);
            color: #4A3F35 !important;
            border: 2px solid #B8A88A;
            border-radius: 10px;
            padding: 0.7rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }}
        
        .stButton > button:hover {{
            background: linear-gradient(145deg, #F5EFE0 0%, #EDE5D3 100%);
            border-color: #8B7355;
            transform: translateY(-1px);
        }}
        
        [data-testid="stExpander"] {{
            background-color: #FFFEFA;
            border: 1px solid #D4C5A9;
            border-radius: 10px;
        }}
        
        /* Fix expander content text visibility */
        [data-testid="stExpander"] [data-testid="stMarkdownContainer"] {{
            color: #3D3428 !important;
        }}
        
        [data-testid="stExpander"] [data-testid="stMarkdownContainer"] p {{
            color: #3D3428 !important;
        }}
        
        [data-testid="stExpander"] [data-testid="stMarkdownContainer"] li {{
            color: #3D3428 !important;
        }}
        
        [data-testid="stExpander"] [data-testid="stMarkdownContainer"] strong {{
            color: #2D2418 !important;
        }}
        
        [data-testid="stExpander"] summary {{
            color: #3D3428 !important;
        }}
        
        [data-testid="stExpander"] summary span {{
            color: #3D3428 !important;
        }}
        
        [data-testid="stPlotlyChart"] {{
            background-color: #FFFEFA;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 4px 15px rgba(74, 55, 40, 0.08);
            border: 1px solid #E8DCC8;
        }}
        
        /* Download button styling - light background with dark text */
        .stDownloadButton > button {{
            background: linear-gradient(145deg, #FFFEFA 0%, #F5EFE0 100%) !important;
            color: #3D3428 !important;
            border: 2px solid #B8A88A !important;
            border-radius: 10px;
            padding: 0.7rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }}
        
        .stDownloadButton > button:hover {{
            background: linear-gradient(145deg, #F5EFE0 0%, #EDE5D3 100%) !important;
            border-color: #8B7355 !important;
            transform: translateY(-1px);
        }}
        
        .stDownloadButton > button span,
        .stDownloadButton > button p {{
            color: #3D3428 !important;
        }}
        
        .risk-gauge {{
            text-align: center;
            padding: 1rem;
            border-radius: 10px;
            margin: 0.5rem 0;
        }}
        
        .risk-very-low {{ background-color: #d4edda; border: 2px solid #28a745; }}
        .risk-low {{ background-color: #d1ecf1; border: 2px solid #17a2b8; }}
        .risk-moderate {{ background-color: #fff3cd; border: 2px solid #ffc107; }}
        .risk-high {{ background-color: #f8d7da; border: 2px solid #dc3545; }}
        .risk-very-high {{ background-color: #721c24; border: 2px solid #721c24; color: white; }}
    </style>
    """, unsafe_allow_html=True)

apply_custom_css()


# =============================================================================
# CONSTANTS AND CONFIGURATION
# =============================================================================
ASSETS = {
    "cryptocurrencies": {
        "BTC-USD": "Bitcoin",
        "ETH-USD": "Ethereum",
        "SOL-USD": "Solana",
        "BNB-USD": "Binance Coin"
    },
    "indices": {
        "^GSPC": "S&P 500",
        "^IXIC": "NASDAQ",
        "^DJI": "Dow Jones",
        "^FCHI": "CAC 40",
        "^STOXX50E": "Euro Stoxx 50"
    },
    "tech_stocks": {
        "AAPL": "Apple",
        "MSFT": "Microsoft",
        "GOOGL": "Google",
        "NVDA": "NVIDIA",
        "META": "Meta"
    },
    "commodities": {
        "GC=F": "Gold",
        "SI=F": "Silver",
        "CL=F": "Oil (WTI)"
    }
}

ALL_ASSETS = {}
for category, assets in ASSETS.items():
    ALL_ASSETS.update(assets)

TICKER_TO_NAME = {ticker: name for ticker, name in ALL_ASSETS.items()}
NAME_TO_TICKER = {name: ticker for ticker, name in ALL_ASSETS.items()}


# =============================================================================
# DATA LOADING FUNCTIONS
# =============================================================================
@st.cache_data(ttl=3600)
def load_asset_data(ticker: str, years: int) -> pd.DataFrame:
    """Load historical data for an asset."""
    today = datetime.today()
    start_date = today - timedelta(days=365 * years)
    
    try:
        data = yf.Ticker(ticker).history(start=start_date, end=today)
        if data.empty:
            return pd.DataFrame()
        
        df = pd.DataFrame(data)
        df.reset_index(inplace=True)
        df['Date'] = pd.to_datetime(df['Date']).dt.date
        return df
    except Exception as e:
        st.error(f"{t('error_fetching')} {ticker}: {e}")
        return pd.DataFrame()


@st.cache_data(ttl=3600)
def get_asset_info(ticker: str) -> dict:
    """Get detailed asset information."""
    try:
        info = yf.Ticker(ticker).info
        return info
    except:
        return {}


def normalize_series(series: pd.Series) -> pd.Series:
    """Normalize a series (z-score)."""
    return (series - series.mean()) / series.std()


def calculate_returns(prices: pd.Series) -> float:
    """Calculate total return in percentage."""
    if len(prices) < 2:
        return 0.0
    return ((prices.iloc[-1] / prices.iloc[0]) - 1) * 100


def calculate_volatility(prices: pd.Series, annualize: bool = True) -> float:
    """Calculate volatility (standard deviation of returns)."""
    returns = prices.pct_change().dropna()
    vol = returns.std()
    if annualize:
        vol *= np.sqrt(252)
    return vol * 100


def calculate_drawdown(prices: pd.Series) -> pd.Series:
    """Calculate drawdown from all-time high."""
    peak = prices.cummax()
    drawdown = (prices - peak) / peak * 100
    return drawdown


def calculate_sharpe_ratio(prices: pd.Series, risk_free_rate: float = 0.04) -> float:
    """Calculate simplified Sharpe ratio."""
    returns = prices.pct_change().dropna()
    excess_return = returns.mean() * 252 - risk_free_rate
    volatility = returns.std() * np.sqrt(252)
    if volatility == 0:
        return 0
    return excess_return / volatility


@st.cache_data(ttl=3600)
def get_news(ticker: str) -> list:
    """Get news via Yahoo Finance RSS."""
    try:
        feed = feedparser.parse(f"https://feeds.finance.yahoo.com/rss/2.0/headline?s={ticker}")
        return feed.entries[:5]
    except:
        return []


# =============================================================================
# CREDIT RISK FUNCTIONS (MERTON MODEL)
# =============================================================================
def calculate_distance_to_default(V: float, D: float, sigma_V: float, r: float, T: float) -> float:
    """
    Calculate distance to default using Merton model.
    
    Parameters:
    -----------
    V : float - Asset value (market cap + debt proxy)
    D : float - Debt face value (default barrier)
    sigma_V : float - Asset volatility (annualized, as decimal)
    r : float - Risk-free rate (as decimal)
    T : float - Time horizon (years)
    
    Returns:
    --------
    float - Distance to default (in standard deviations)
    """
    if D <= 0 or V <= 0 or sigma_V <= 0 or T <= 0:
        return 0.0
    
    numerator = np.log(V / D) + (r - 0.5 * sigma_V**2) * T
    denominator = sigma_V * np.sqrt(T)
    
    return numerator / denominator


def calculate_probability_of_default(DD: float) -> float:
    """
    Convert distance to default to probability of default.
    
    Parameters:
    -----------
    DD : float - Distance to default
    
    Returns:
    --------
    float - Probability of default (0 to 1)
    """
    return norm.cdf(-DD)


def get_risk_category(pd_value: float) -> tuple:
    """
    Categorize risk based on probability of default.
    
    Returns:
    --------
    tuple - (category_key, css_class)
    """
    if pd_value < 0.01:
        return ("very_low_risk", "risk-very-low")
    elif pd_value < 0.05:
        return ("low_risk", "risk-low")
    elif pd_value < 0.15:
        return ("moderate_risk", "risk-moderate")
    elif pd_value < 0.30:
        return ("high_risk", "risk-high")
    else:
        return ("very_high_risk", "risk-very-high")


@st.cache_data(ttl=1800)
def get_credit_risk_data(ticker: str) -> dict:
    """
    Fetch all data needed for credit risk analysis.
    
    Returns:
    --------
    dict with keys: market_cap, total_debt, cash, equity_volatility, company_name, success
    """
    try:
        stock = yf.Ticker(ticker)
        info = stock.info
        
        # Get market cap
        market_cap = info.get('marketCap', None)
        
        # Get balance sheet data
        balance_sheet = stock.balance_sheet
        
        total_debt = None
        cash = None
        
        if not balance_sheet.empty:
            bs = balance_sheet.T
            if 'Total Debt' in bs.columns:
                total_debt = bs['Total Debt'].iloc[0]
            if 'Cash Cash Equivalents And Short Term Investments' in bs.columns:
                cash = bs['Cash Cash Equivalents And Short Term Investments'].iloc[0]
            elif 'Cash And Cash Equivalents' in bs.columns:
                cash = bs['Cash And Cash Equivalents'].iloc[0]
        
        # Calculate equity volatility from historical prices
        hist = stock.history(period="2y")
        if not hist.empty and len(hist) > 20:
            log_returns = np.log(hist['Close'] / hist['Close'].shift(1)).dropna()
            daily_vol = log_returns.std()
            annual_vol = daily_vol * np.sqrt(252)
        else:
            annual_vol = None
        
        company_name = info.get('longName', info.get('shortName', ticker))
        
        return {
            'market_cap': market_cap,
            'total_debt': total_debt,
            'cash': cash,
            'equity_volatility': annual_vol,
            'company_name': company_name,
            'success': market_cap is not None and total_debt is not None and annual_vol is not None
        }
    except Exception as e:
        return {'success': False, 'error': str(e)}


# =============================================================================
# AI ECONOMIC ANALYSIS FUNCTIONS
# =============================================================================
CONTINENT_INDICATORS = {
    "north_america": {
        "indices": ["^GSPC", "^DJI", "^IXIC", "^GSPTSE"],
        "names": ["S&P 500", "Dow Jones", "NASDAQ", "TSX (Canada)"],
        "countries": ["USA", "Canada", "Mexico"]
    },
    "south_america": {
        "indices": ["^BVSP", "^MERV", "^IPSA"],
        "names": ["Bovespa (Brazil)", "MERVAL (Argentina)", "IPSA (Chile)"],
        "countries": ["Brazil", "Argentina", "Chile", "Colombia"]
    },
    "europe": {
        "indices": ["^STOXX50E", "^FTSE", "^GDAXI", "^FCHI"],
        "names": ["Euro Stoxx 50", "FTSE 100", "DAX", "CAC 40"],
        "countries": ["Germany", "UK", "France", "Italy", "Spain"]
    },
    "asia": {
        "indices": ["^N225", "^HSI", "000001.SS", "^BSESN"],
        "names": ["Nikkei 225", "Hang Seng", "Shanghai", "BSE Sensex"],
        "countries": ["Japan", "China", "India", "South Korea", "Singapore"]
    },
    "africa": {
        "indices": ["^JN0U.JO", "EGX30.CA"],
        "names": ["JSE Top 40 (South Africa)", "EGX 30 (Egypt)"],
        "countries": ["South Africa", "Egypt", "Nigeria", "Kenya"]
    },
    "oceania": {
        "indices": ["^AXJO", "^NZ50"],
        "names": ["ASX 200 (Australia)", "NZX 50 (New Zealand)"],
        "countries": ["Australia", "New Zealand"]
    }
}


def get_continent_data(continent_key: str) -> dict:
    """Fetch recent performance data for continent indices."""
    indicators = CONTINENT_INDICATORS.get(continent_key, {})
    results = {}
    
    for ticker, name in zip(indicators.get("indices", []), indicators.get("names", [])):
        try:
            data = yf.Ticker(ticker).history(period="1mo")
            if not data.empty:
                current = data['Close'].iloc[-1]
                month_ago = data['Close'].iloc[0]
                change_pct = ((current - month_ago) / month_ago) * 100
                results[name] = {
                    "current": current,
                    "change_1m": change_pct
                }
        except:
            continue
    
    return results


def generate_economic_analysis(continent_key: str, continent_name: str, api_key: str, language: str = "English") -> str:
    """Generate economic analysis using Groq API with Llama 3."""
    
    market_data = get_continent_data(continent_key)
    indicators = CONTINENT_INDICATORS.get(continent_key, {})
    
    market_context = ""
    for name, data in market_data.items():
        direction = "up" if data["change_1m"] > 0 else "down"
        market_context += f"- {name}: {data['current']:.2f} ({direction} {abs(data['change_1m']):.1f}% this month)\n"
    
    countries = ", ".join(indicators.get("countries", []))
    
    lang_instruction = {
        "English": "Respond in English.",
        "FranÃ§ais": "RÃ©ponds en franÃ§ais.",
        "EspaÃ±ol": "Responde en espaÃ±ol.",
        "ä¸­æ–‡": "è¯·ç”¨ä¸­æ–‡å›žå¤ã€‚",
        "Ð ÑƒÑÑÐºÐ¸Ð¹": "ÐžÑ‚Ð²ÐµÑ‡Ð°Ð¹ Ð½Ð° Ñ€ÑƒÑÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ.",
        "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©": "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø±Ø¯ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©."
    }.get(language, "Respond in English.")
    
    prompt = f"""{lang_instruction}

You are an expert economic analyst. Provide a comprehensive but concise analysis of the current economic state of {continent_name}.

Current Market Data:
{market_context}

Major economies in this region: {countries}

Please provide:
1. **Overall Economic Health** (2-3 sentences)
2. **Key Trends** (3-4 bullet points on current economic trends)
3. **Challenges** (2-3 main challenges facing the region)
4. **Opportunities** (2-3 investment or growth opportunities)
5. **Short-term Outlook** (1-2 sentences on what to expect in the next 3-6 months)

Keep the analysis factual, balanced, and around 300-400 words total."""

    try:
        response = requests.post(
            "https://api.groq.com/openai/v1/chat/completions",
            headers={
                "Authorization": f"Bearer {api_key}",
                "Content-Type": "application/json"
            },
            json={
                "model": "llama-3.3-70b-versatile",
                "messages": [
                    {"role": "system", "content": "You are a professional economic analyst."},
                    {"role": "user", "content": prompt}
                ],
                "temperature": 0.7,
                "max_tokens": 1000
            },
            timeout=30
        )
        
        if response.status_code == 200:
            return response.json()["choices"][0]["message"]["content"]
        else:
            return None
            
    except Exception as e:
        return None


# =============================================================================
# SIDEBAR
# =============================================================================
with st.sidebar:
    st.subheader(t("language"))
    language = st.selectbox(
        "Language",
        options=list(TRANSLATIONS.keys()),
        index=list(TRANSLATIONS.keys()).index(st.session_state.language),
        label_visibility="collapsed"
    )
    
    if language != st.session_state.language:
        st.session_state.language = language
        st.rerun()
    
    st.markdown("---")
    st.header(t("settings"))
    
    st.subheader(t("asset_selection"))
    
    asset1_name = st.selectbox(
        t("first_asset"),
        options=list(NAME_TO_TICKER.keys()),
        index=list(NAME_TO_TICKER.keys()).index("Bitcoin")
    )
    asset1_ticker = NAME_TO_TICKER[asset1_name]
    
    asset2_name = st.selectbox(
        t("second_asset"),
        options=list(NAME_TO_TICKER.keys()),
        index=list(NAME_TO_TICKER.keys()).index("S&P 500")
    )
    asset2_ticker = NAME_TO_TICKER[asset2_name]
    
    st.subheader(t("period"))
    years = st.slider(t("num_years"), min_value=1, max_value=10, value=5)
    
    st.subheader(t("display_options"))
    show_normalized = st.checkbox(t("show_normalized"), value=True)
    show_drawdown = st.checkbox(t("show_drawdown"), value=True)
    show_volume = st.checkbox(t("show_volume"), value=False)
    
    st.markdown("---")
    
    if st.button(t("refresh_data"), use_container_width=True):
        st.cache_data.clear()
        st.rerun()
    
    st.markdown("---")
    st.caption(t("created_with"))
    st.caption(f"{t('last_update')}: {datetime.now().strftime('%H:%M:%S')}")


# =============================================================================
# MAIN CONTENT WITH TABS
# =============================================================================
st.title(t("main_title"))

# Create tabs
tab_comparison, tab_economic, tab_credit = st.tabs([
    f"ðŸ“Š {t('performance_comparison')}", 
    f"ðŸŒ {t('economic_analysis')}",
    f"ðŸ¦ {t('credit_risk')}"
])

# =============================================================================
# TAB 1: ASSET COMPARISON
# =============================================================================
with tab_comparison:
    st.markdown(f"**{t('comparison')}:** {asset1_name} {t('vs')} {asset2_name} {t('over')} {years} {t('years')}")
    
    with st.spinner(t("loading_data")):
        df1 = load_asset_data(asset1_ticker, years)
        df2 = load_asset_data(asset2_ticker, years)
    
    if df1.empty or df2.empty:
        st.error(t("error_loading"))
        st.stop()
    
    # Key Metrics
    st.header(t("key_metrics"))
    
    col1, col2, col3, col4 = st.columns(4)
    
    return1 = calculate_returns(df1['Close'])
    with col1:
        st.metric(label=f"{t('return')} {asset1_name}", value=f"{return1:.1f}%",
                  delta=f"{return1:.1f}%" if return1 != 0 else None)
    
    return2 = calculate_returns(df2['Close'])
    with col2:
        st.metric(label=f"{t('return')} {asset2_name}", value=f"{return2:.1f}%",
                  delta=f"{return2:.1f}%" if return2 != 0 else None)
    
    vol1 = calculate_volatility(df1['Close'])
    with col3:
        st.metric(label=f"{t('volatility')} {asset1_name}", value=f"{vol1:.1f}%")
    
    vol2 = calculate_volatility(df2['Close'])
    with col4:
        st.metric(label=f"{t('volatility')} {asset2_name}", value=f"{vol2:.1f}%")
    
    col5, col6, col7, col8 = st.columns(4)
    
    with col5:
        st.metric(label=f"{t('current_price')} {asset1_name}", value=f"${df1['Close'].iloc[-1]:,.2f}")
    
    with col6:
        st.metric(label=f"{t('current_price')} {asset2_name}", value=f"${df2['Close'].iloc[-1]:,.2f}")
    
    with col7:
        st.metric(label=f"{t('sharpe')} {asset1_name}", value=f"{calculate_sharpe_ratio(df1['Close']):.2f}")
    
    with col8:
        st.metric(label=f"{t('sharpe')} {asset2_name}", value=f"{calculate_sharpe_ratio(df2['Close']):.2f}")
    
    # Main Chart
    st.markdown("---")
    st.header(t("performance_comparison"))
    
    df1_plot = df1[['Date', 'Close']].copy()
    df2_plot = df2[['Date', 'Close']].copy()
    
    if show_normalized:
        df1_plot['Close'] = normalize_series(df1['Close'])
        df2_plot['Close'] = normalize_series(df2['Close'])
        y_label = t("normalized_price_zscore")
    else:
        y_label = t("price_usd")
    
    df1_plot = df1_plot.rename(columns={'Close': asset1_name})
    df2_plot = df2_plot.rename(columns={'Close': asset2_name})
    
    merged = pd.merge(df1_plot, df2_plot, on='Date', how='inner')
    merged_melted = merged.melt(id_vars=['Date'], var_name=t('asset'), value_name=t('prices'))
    
    chart_title = f"{t('normalized_prices') if show_normalized else t('prices')}: {asset1_name} {t('vs')} {asset2_name}"
    fig_main = px.line(merged_melted, x='Date', y=t('prices'), color=t('asset'), title=chart_title,
                       color_discrete_map={asset1_name: '#C45B28', asset2_name: '#1B6B4A'},
                       template='plotly_white')
    
    fig_main.update_layout(
        xaxis_title=t("date"), yaxis_title=y_label,
        hovermode="x unified", height=450,
        paper_bgcolor='rgba(0,0,0,0)', plot_bgcolor='#FFFEFA',
        font=dict(family="Source Sans Pro, sans-serif", color='#2D2418', size=12),
        title=dict(font=dict(color='#2D2418', size=16)),
        legend=dict(
            orientation="h", yanchor="bottom", y=1.02, xanchor="center", x=0.5,
            font=dict(color='#2D2418', size=12),
            bgcolor='rgba(255,254,250,0.9)'
        ),
        xaxis=dict(tickfont=dict(color='#3D3428')),
        yaxis=dict(tickfont=dict(color='#3D3428'))
    )
    fig_main.update_traces(line=dict(width=2.5))
    st.plotly_chart(fig_main, use_container_width=True)
    
    # Drawdown Chart
    if show_drawdown:
        st.markdown("---")
        st.header(t("drawdowns_title"))
        
        df1['Drawdown'] = calculate_drawdown(df1['Close'])
        df2['Drawdown'] = calculate_drawdown(df2['Close'])
        
        fig_dd = go.Figure()
        fig_dd.add_trace(go.Scatter(x=df1['Date'], y=df1['Drawdown'], fill='tozeroy', name=asset1_name,
                                     line=dict(color='#C45B28', width=2), fillcolor='rgba(196, 91, 40, 0.25)'))
        fig_dd.add_trace(go.Scatter(x=df2['Date'], y=df2['Drawdown'], fill='tozeroy', name=asset2_name,
                                     line=dict(color='#1B6B4A', width=2), fillcolor='rgba(27, 107, 74, 0.25)'))
        
        fig_dd.update_layout(
            title=dict(text=t("drawdowns_from_ath"), font=dict(color='#2D2418', size=16)),
            xaxis_title=t("date"), yaxis_title="Drawdown (%)",
            template='plotly_white', height=350, paper_bgcolor='rgba(0,0,0,0)', plot_bgcolor='#FFFEFA',
            font=dict(family="Source Sans Pro, sans-serif", color='#2D2418', size=12),
            legend=dict(
                orientation="h", yanchor="bottom", y=1.02, xanchor="center", x=0.5,
                font=dict(color='#2D2418', size=12),
                bgcolor='rgba(255,254,250,0.9)'
            ),
            xaxis=dict(tickfont=dict(color='#3D3428')),
            yaxis=dict(tickfont=dict(color='#3D3428'))
        )
        st.plotly_chart(fig_dd, use_container_width=True)
        
        col_dd1, col_dd2 = st.columns(2)
        with col_dd1:
            st.metric(f"{t('max_drawdown')} {asset1_name}", f"{df1['Drawdown'].min():.1f}%")
        with col_dd2:
            st.metric(f"{t('max_drawdown')} {asset2_name}", f"{df2['Drawdown'].min():.1f}%")
    
    # Volume Chart
    if show_volume:
        st.markdown("---")
        st.header(t("trading_volumes"))
        
        fig_vol = make_subplots(rows=2, cols=1, shared_xaxes=True,
                                subplot_titles=(f"{t('volume')} {asset1_name}", f"{t('volume')} {asset2_name}"))
        fig_vol.add_trace(go.Bar(x=df1['Date'], y=df1['Volume'], name=asset1_name, marker=dict(color='#C45B28')), row=1, col=1)
        fig_vol.add_trace(go.Bar(x=df2['Date'], y=df2['Volume'], name=asset2_name, marker=dict(color='#1B6B4A')), row=2, col=1)
        
        fig_vol.update_layout(height=450, template='plotly_white', showlegend=False,
                              paper_bgcolor='rgba(0,0,0,0)', plot_bgcolor='#FFFEFA',
                              font=dict(family="Source Sans Pro, sans-serif", color='#2D2418', size=12))
        fig_vol.update_xaxes(tickfont=dict(color='#3D3428'))
        fig_vol.update_yaxes(tickfont=dict(color='#3D3428'))
        fig_vol.update_annotations(font=dict(color='#2D2418', size=14))
        st.plotly_chart(fig_vol, use_container_width=True)
    
    # Correlation
    st.markdown("---")
    st.header(t("correlation_analysis"))
    
    merged_corr = pd.merge(df1[['Date', 'Close']].rename(columns={'Close': 'Asset1'}),
                           df2[['Date', 'Close']].rename(columns={'Close': 'Asset2'}), on='Date', how='inner')
    merged_corr['Return1'] = merged_corr['Asset1'].pct_change()
    merged_corr['Return2'] = merged_corr['Asset2'].pct_change()
    merged_corr['Rolling_Corr'] = merged_corr['Return1'].rolling(window=30).corr(merged_corr['Return2'])
    
    col_corr1, col_corr2 = st.columns([1, 2])
    
    with col_corr1:
        overall_corr = merged_corr['Return1'].corr(merged_corr['Return2'])
        st.metric(t("overall_correlation"), f"{overall_corr:.3f}")
        st.markdown(f"""**{t('interpretation')}:**
        - **> 0.7**: {t('strong_positive')}
        - **0.3 - 0.7**: {t('moderate')}
        - **-0.3 - 0.3**: {t('weak')}
        - **< -0.3**: {t('negative')}""")
    
    with col_corr2:
        fig_corr = px.line(merged_corr, x='Date', y='Rolling_Corr', title=f"{t('rolling_correlation')} (30 {t('days')})")
        fig_corr.add_hline(y=0, line_dash="dash", line_color="#8B7355")
        fig_corr.update_traces(line=dict(color='#C45B28', width=2.5))
        fig_corr.update_layout(
            yaxis_title=t("overall_correlation"), height=300,
            paper_bgcolor='rgba(0,0,0,0)', plot_bgcolor='#FFFEFA',
            font=dict(family="Source Sans Pro, sans-serif", color='#2D2418', size=12),
            title=dict(font=dict(color='#2D2418', size=14)),
            xaxis=dict(tickfont=dict(color='#3D3428')),
            yaxis=dict(tickfont=dict(color='#3D3428'))
        )
        st.plotly_chart(fig_corr, use_container_width=True)
    
    # News
    st.markdown("---")
    st.header(t("recent_news"))
    
    col_news1, col_news2 = st.columns(2)
    
    with col_news1:
        st.subheader(f"ðŸ“° {asset1_name}")
        news1 = get_news(asset1_ticker)
        if news1:
            for entry in news1:
                st.markdown(f"**[{entry.title}]({entry.link})**")
                if hasattr(entry, 'published'):
                    st.caption(entry.published)
                st.markdown("---")
        else:
            st.info(t("no_news"))
    
    with col_news2:
        st.subheader(f"ðŸ“° {asset2_name}")
        news2 = get_news(asset2_ticker)
        if news2:
            for entry in news2:
                st.markdown(f"**[{entry.title}]({entry.link})**")
                if hasattr(entry, 'published'):
                    st.caption(entry.published)
                st.markdown("---")
        else:
            st.info(t("no_news"))
    
    # Raw Data & Export
    st.markdown("---")
    st.header(t("raw_data"))
    
    with st.expander(f"{t('view_data')} {asset1_name}"):
        st.dataframe(df1, use_container_width=True)
    
    with st.expander(f"{t('view_data')} {asset2_name}"):
        st.dataframe(df2, use_container_width=True)
    
    st.markdown("---")
    st.header(t("export_data"))
    
    col_export1, col_export2 = st.columns(2)
    with col_export1:
        st.download_button(label=f"{t('download')} {asset1_name} (CSV)", data=df1.to_csv(index=False),
                           file_name=f"{asset1_ticker}_{years}y.csv", mime="text/csv")
    with col_export2:
        st.download_button(label=f"{t('download')} {asset2_name} (CSV)", data=df2.to_csv(index=False),
                           file_name=f"{asset2_ticker}_{years}y.csv", mime="text/csv")


# =============================================================================
# TAB 2: ECONOMIC ANALYSIS
# =============================================================================
with tab_economic:
    st.markdown(f"*{t('analysis_disclaimer')}*")
    
    api_key_from_secrets = st.secrets.get("GROQ_API_KEY", None) if hasattr(st, 'secrets') else None
    
    if api_key_from_secrets:
        api_key = api_key_from_secrets
        st.success("âœ… API Key loaded from secrets")
    else:
        st.subheader(t("api_key_required"))
        st.markdown(f"{t('api_key_help')} [console.groq.com](https://console.groq.com)")
        api_key = st.text_input(t("enter_api_key"), type="password")
    
    st.markdown("---")
    
    continents_dict = t("continents")
    if isinstance(continents_dict, dict):
        continent_options = list(continents_dict.values())
        continent_keys = list(continents_dict.keys())
    else:
        continent_options = ["North America", "South America", "Europe", "Asia", "Africa", "Oceania"]
        continent_keys = ["north_america", "south_america", "europe", "asia", "africa", "oceania"]
    
    selected_continent = st.selectbox(t("select_continent"), options=continent_options)
    selected_idx = continent_options.index(selected_continent)
    selected_key = continent_keys[selected_idx]
    
    st.subheader(t("economic_indicators"))
    market_data = get_continent_data(selected_key)
    
    if market_data:
        cols = st.columns(min(len(market_data), 4))
        for idx, (name, data) in enumerate(market_data.items()):
            with cols[idx % 4]:
                st.metric(label=name, value=f"{data['current']:,.2f}", delta=f"{data['change_1m']:+.1f}% (1M)")
    
    st.markdown("---")
    
    if st.button(t("generate_analysis"), use_container_width=True, disabled=not api_key):
        if api_key:
            with st.spinner(t("loading_analysis")):
                analysis = generate_economic_analysis(selected_key, selected_continent, api_key, st.session_state.language)
                if analysis:
                    st.subheader(t("ai_analysis"))
                    st.markdown(analysis)
                    st.caption(f"{t('last_analysis')}: {datetime.now().strftime('%Y-%m-%d %H:%M')}")
                else:
                    st.error(t("analysis_error"))
    
    if not api_key:
        st.info("ðŸ‘† " + t("api_key_required") + " " + t("api_key_help") + " [console.groq.com](https://console.groq.com)")


# =============================================================================
# TAB 3: CREDIT RISK ANALYSIS
# =============================================================================
with tab_credit:
    st.markdown(f"### {t('credit_risk_title')}")
    st.markdown(f"*{t('merton_explanation')}*")
    
    st.markdown("---")
    
    # Input section
    col_input1, col_input2 = st.columns([2, 1])
    
    with col_input1:
        ticker_input = st.text_input(t("enter_ticker"), value="AAPL", placeholder="e.g., AAPL, MSFT, BA")
    
    with col_input2:
        risk_free_rate = st.number_input(t("risk_free_rate"), min_value=0.0, max_value=0.20, value=0.045, step=0.005, format="%.3f")
        time_horizon = st.number_input(t("time_horizon"), min_value=0.5, max_value=5.0, value=1.0, step=0.5)
    
    analyze_button = st.button(t("analyze_button"), use_container_width=True, type="primary")
    
    if analyze_button and ticker_input:
        with st.spinner(t("analyzing")):
            data = get_credit_risk_data(ticker_input.upper())
            
            if data.get('success', False):
                # Calculate Merton model
                market_cap = data['market_cap']
                total_debt = data['total_debt']
                equity_vol = data['equity_volatility']
                company_name = data['company_name']
                
                # Asset value = Market Cap + Debt (simplified)
                V = market_cap + total_debt
                D = total_debt
                sigma_V = equity_vol  # Using equity vol as proxy (simplification)
                
                DD = calculate_distance_to_default(V, D, sigma_V, risk_free_rate, time_horizon)
                PD = calculate_probability_of_default(DD)
                risk_cat, risk_class = get_risk_category(PD)
                
                st.markdown("---")
                st.subheader(f"ðŸ“Š {company_name} ({ticker_input.upper()})")
                
                # Results in columns
                col_res1, col_res2, col_res3 = st.columns(3)
                
                with col_res1:
                    st.metric(t("distance_to_default"), f"{DD:.2f}Ïƒ")
                
                with col_res2:
                    st.metric(t("probability_of_default"), f"{PD*100:.2f}%")
                
                with col_res3:
                    st.markdown(f"""
                    <div class="risk-gauge {risk_class}">
                        <strong>{t('risk_category')}</strong><br>
                        <span style="font-size: 1.5em;">{t(risk_cat)}</span>
                    </div>
                    """, unsafe_allow_html=True)
                
                # Model inputs display
                st.markdown("---")
                with st.expander(t("model_inputs")):
                    col_inp1, col_inp2, col_inp3 = st.columns(3)
                    
                    with col_inp1:
                        st.metric(t("market_cap"), f"${market_cap/1e9:.2f}B")
                        st.metric(t("total_debt"), f"${total_debt/1e9:.2f}B")
                    
                    with col_inp2:
                        st.metric(t("asset_value"), f"${V/1e9:.2f}B")
                        st.metric(t("equity_volatility"), f"{equity_vol*100:.1f}%")
                    
                    with col_inp3:
                        st.metric(t("risk_free_rate"), f"{risk_free_rate*100:.1f}%")
                        st.metric(t("time_horizon"), f"{time_horizon} {t('years')}")
                
                # Interpretation
                st.markdown("---")
                st.markdown(f"""
                **{t('interpretation')}:**
                
                - **{t('distance_to_default')}**: {DD:.2f}Ïƒ means the firm's asset value would need to fall by {DD:.2f} standard deviations to reach the default barrier.
                - **{t('probability_of_default')}**: Based on the Merton model, there is a **{PD*100:.2f}%** probability of default within {time_horizon} year(s).
                - A higher Distance to Default indicates lower credit risk. Values above 3Ïƒ typically indicate very safe companies.
                """)
                
                # Benchmark comparison
                st.markdown("---")
                st.subheader(t("benchmark_companies"))
                
                benchmark_tickers = ['AAPL', 'MSFT', 'BA', 'F', 'AAL']
                benchmark_data = []
                
                for bticker in benchmark_tickers:
                    if bticker.upper() != ticker_input.upper():
                        bdata = get_credit_risk_data(bticker)
                        if bdata.get('success', False):
                            bV = bdata['market_cap'] + bdata['total_debt']
                            bDD = calculate_distance_to_default(bV, bdata['total_debt'], bdata['equity_volatility'], risk_free_rate, time_horizon)
                            bPD = calculate_probability_of_default(bDD)
                            benchmark_data.append({
                                'Ticker': bticker,
                                'Company': bdata['company_name'][:20],
                                'DD (Ïƒ)': f"{bDD:.2f}",
                                'PD (%)': f"{bPD*100:.2f}%"
                            })
                
                if benchmark_data:
                    # Add the analyzed company
                    benchmark_data.insert(0, {
                        'Ticker': ticker_input.upper(),
                        'Company': company_name[:20] + " â­",
                        'DD (Ïƒ)': f"{DD:.2f}",
                        'PD (%)': f"{PD*100:.2f}%"
                    })
                    
                    bench_df = pd.DataFrame(benchmark_data)
                    st.dataframe(bench_df, use_container_width=True, hide_index=True)
                
            else:
                st.error(t("data_unavailable"))
                if 'error' in data:
                    st.caption(f"Error: {data['error']}")
    
    # ML Model section (informational)
    st.markdown("---")
    with st.expander(f"â„¹ï¸ {t('ml_model')}"):
        st.markdown(f"""
        **{t('ml_explanation')}**
        
        The ML model was trained on the American Bankruptcy Dataset containing:
        - 78,682 firm-year observations (1999-2018)
        - 18 financial ratios (profitability, leverage, liquidity, activity)
        - Binary classification: bankrupt vs. non-bankrupt
        
        **Model Performance:**
        - Validation AUC-ROC: 0.739
        - Test AUC-ROC: 0.754
        
        **Top Predictive Features:**
        1. Industry sector (Division)
        2. X1 (likely a profitability ratio)
        3. X15 (likely a leverage ratio)
        
        **Limitation:** Live predictions would require mapping current financial statement data from Yahoo Finance to the exact ratios used in training (X1-X18 from Compustat). This mapping is non-trivial and would require access to the original feature definitions.
        """)
